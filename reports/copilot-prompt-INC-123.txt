You are a senior Site Reliability Engineer performing a blameless post-mortem.

Rules:
- Base conclusions ONLY on the evidence provided
- Distinguish causation from correlation
- If uncertain, state uncertainty and assign confidence levels

Incident:
- ID: INC-123
- Service: api-gateway
- Incident start time: 2026-02-12T11:16:00

Git commits:
f320420 Add initial implementation of Sherlock CLI tool for incident investigation
f09a9a5 Add basic input validation to request handler
eec73e4 Add request caching for performance
5fc0fb4 Initial stable request handler

Commit diff:
commit f320420cc8ad5838c16e80ed1e57ff123677d5a2
Author: Agastya <krishkhati0007king@gmail.com>
Date:   Thu Feb 5 21:37:28 2026 +0530

    Add initial implementation of Sherlock CLI tool for incident investigation

diff --git a/README.md b/README.md
new file mode 100644
index 0000000..98e8c6a
--- /dev/null
+++ b/README.md
@@ -0,0 +1,42 @@
+# Copilot Sherlock üîç
+
+Copilot Sherlock is a CLI tool that performs automated incident investigation and root cause analysis using GitHub Copilot CLI.
+
+## What it does
+
+With a single command, Sherlock:
+- Analyzes recent git commits and diffs
+- Correlates deployments with logs and metrics
+- Identifies the most likely root cause
+- Generates a blameless post-mortem with confidence scores
+
+## Usage
+
+```bash
+./sherlock
+```
+
+## Why Copilot CLI
+
+Copilot Sherlock uses GitHub Copilot CLI as an investigative reasoning engine:
+
+- Runs inside the repository
+- Operates directly on git history and operational data
+- Synthesizes evidence across multiple sources
+- Produces structured post-mortems in seconds
+
+## How Copilot CLI Is Used
+
+Copilot Sherlock uses GitHub Copilot CLI as the core reasoning engine. For each investigation:
+- Sherlock collects deterministic evidence (git history, diffs, logs, metrics)
+- A structured investigation prompt is generated and saved
+- GitHub Copilot CLI performs cross-source correlation and RCA
+- Both the prompt and Copilot's post-mortem output are persisted for auditability
+
+## Demo Scenario
+
+This repo includes a controlled incident where a caching change introduces an unbounded memory leak. Sherlock correctly identifies the offending commit, explains the failure mechanism, and suggests remediation.
+
+## Disclaimer
+
+This demo uses simulated logs, metrics, and deployments. The architecture is designed to support real production data sources.
diff --git a/evidence/app.log b/evidence/app.log
new file mode 100644
index 0000000..64cf6c6
--- /dev/null
+++ b/evidence/app.log
@@ -0,0 +1,5 @@
+2026-02-12T11:14:58 INFO  Starting api-gateway
+2026-02-12T11:15:02 INFO  Deployment version v1.1.0
+2026-02-12T11:16:10 WARN  High memory usage detected (85%)
+2026-02-12T11:16:42 ERROR Memory allocation failed
+2026-02-12T11:16:43 ERROR Worker process crashed
diff --git a/evidence/deployments.json b/evidence/deployments.json
new file mode 100644
index 0000000..5faade0
--- /dev/null
+++ b/evidence/deployments.json
@@ -0,0 +1,7 @@
+[
+  {
+    "time": "2026-02-12T11:15:02",
+    "version": "v1.1.0",
+    "commit": "HEAD"
+  }
+]
diff --git a/evidence/metrics.json b/evidence/metrics.json
new file mode 100644
index 0000000..5cba7db
--- /dev/null
+++ b/evidence/metrics.json
@@ -0,0 +1,9 @@
+{
+  "timestamp": [
+    "11:14",
+    "11:15",
+    "11:16"
+  ],
+  "memory_mb": [120, 340, 980],
+  "error_rate_pct": [0.1, 0.2, 3.8]
+}
diff --git a/prompts/investigate.txt b/prompts/investigate.txt
new file mode 100644
index 0000000..f1550c8
--- /dev/null
+++ b/prompts/investigate.txt
@@ -0,0 +1,55 @@
+You are a senior Site Reliability Engineer performing a blameless post-mortem.
+
+You are given raw evidence from a production incident.
+
+Rules:
+- Base conclusions ONLY on the evidence provided
+- Distinguish causation from correlation
+- If uncertain, state uncertainty and assign confidence levels
+- Do not speculate beyond evidence
+
+Incident:
+- ID: INC-123
+- Service: api-gateway
+- Incident start time: 2026-02-12T11:16:00
+
+Git commits (most recent first):
+{{GIT_LOG}}
+
+Commit diff for suspected commit:
+{{GIT_DIFF}}
+
+Deployment events:
+{{DEPLOYMENTS}}
+
+Application logs:
+{{APP_LOGS}}
+
+Metrics:
+{{METRICS}}
+
+Tasks:
+1. Construct a minute-by-minute timeline leading up to the incident
+2. Identify the most likely root cause
+3. Identify the exact commit responsible (hash + message)
+4. Explain WHY this change caused the incident
+5. Propose concrete remediation steps
+6. Assign confidence scores (0‚Äì100%) for your conclusions
+
+Output format (STRICT):
+# Incident Post-Mortem
+
+## Timeline
+- ...
+
+## Root Cause
+...
+
+## Evidence
+- ...
+
+## Remediation
+- ...
+
+## Confidence
+Root cause confidence: X%
diff --git a/reports/copilot-prompt-INC-123.txt b/reports/copilot-prompt-INC-123.txt
new file mode 100644
index 0000000..efcded6
--- /dev/null
+++ b/reports/copilot-prompt-INC-123.txt
@@ -0,0 +1,104 @@
+You are a senior Site Reliability Engineer performing a blameless post-mortem.
+
+Rules:
+- Base conclusions ONLY on the evidence provided
+- Distinguish causation from correlation
+- If uncertain, state uncertainty and assign confidence levels
+
+Incident:
+- ID: INC-123
+- Service: api-gateway
+- Incident start time: 2026-02-12T11:16:00
+
+Git commits:
+f09a9a5 Add basic input validation to request handler
+eec73e4 Add request caching for performance
+5fc0fb4 Initial stable request handler
+
+Commit diff:
+commit f09a9a5351e2a6724fa5436f6e0c2e55d8321237
+Author: Agastya <krishkhati0007king@gmail.com>
+Date:   Thu Feb 5 21:16:43 2026 +0530
+
+    Add basic input validation to request handler
+
+diff --git a/app.py b/app.py
+index 966ec6b..9dfcc3c 100644
+--- a/app.py
++++ b/app.py
+@@ -3,5 +3,9 @@
+ cache = []
+ 
+ def handle_request(data):
++    # Added lightweight input validation
++    if data is None:
++        return {"status": "error", "reason": "invalid input"}
++
+     cache.append(data)  # BUG: unbounded growth
+     return {"status": "ok"}
+
+Deployment events:
+[
+  {
+    "time": "2026-02-12T11:15:02",
+    "version": "v1.1.0",
+    "commit": "HEAD"
+  }
+]
+
+Application logs:
+2026-02-12T11:14:58 INFO  Starting api-gateway
+2026-02-12T11:15:02 INFO  Deployment version v1.1.0
+2026-02-12T11:16:10 WARN  High memory usage detected (85%)
+2026-02-12T11:16:42 ERROR Memory allocation failed
+2026-02-12T11:16:43 ERROR Worker process crashed
+
+Metrics:
+{
+  "timestamp": [
+    "11:14",
+    "11:15",
+    "11:16"
+  ],
+  "memory_mb": [120, 340, 980],
+  "error_rate_pct": [0.1, 0.2, 3.8]
+}
+
+Tasks:
+1. Build a minute-by-minute timeline leading up to the incident
+2. Identify the PRIMARY root cause
+3. Identify any CONTRIBUTING factors
+4. Explicitly list NON-CAUSES that were considered and ruled out
+5. Identify the exact commit responsible (hash + message)
+6. Explain why this change caused the incident (causal chain)
+7. Identify detection gaps (what signals were missing or too late)
+8. Propose concrete remediation and prevention steps
+9. Assign confidence scores (0‚Äì100%) for your conclusions
+
+Output format (STRICT):
+
+# Incident Post-Mortem
+
+## Timeline
+- ...
+
+## Primary Root Cause
+...
+
+## Contributing Factors
+- ...
+
+## Non-Causes Ruled Out
+- ...
+
+## Evidence
+- ...
+
+## Detection & Prevention Gaps
+- ...
+
+## Remediation & Follow-ups
+- ...
+
+## Confidence
+Primary root cause confidence: X%
diff --git a/reports/postmortem-INC-123.md b/reports/postmortem-INC-123.md
new file mode 100644
index 0000000..25beef9
--- /dev/null
+++ b/reports/postmortem-INC-123.md
@@ -0,0 +1,122 @@
+I'll analyze this incident systematically and create the post-mortem report.
+
+‚óè List directory .
+  ‚îî 13 files found
+
+‚óè Verify working directory
+  $ cd /Users/agastya/Documents/sherlock-demo && pwd
+  ‚îî 2 lines...
+
+‚óè Read app.py
+  ‚îî 16 lines read
+
+‚óè Check git history
+  $ cd /Users/agastya/Documents/sherlock-demo && git log --oneline --all
+  ‚îî 4 lines...
+
+‚óè View cache commit diff
+  $ cd /Users/agastya/Documents/sherlock-demo && git show eec73e4
+  ‚îî 19 lines...
+
+‚óè View initial commit
+  $ cd /Users/agastya/Documents/sherlock-demo && git show 5fc0fb4
+  ‚îî 17 lines...
+
+Now I'll create the comprehensive post-mortem report:
+
+‚úó Create reports/INC-123_postmortem.md
+  Permission denied and could not request permission from user
+
+‚óè Check reports directory
+  $ cd /Users/agastya/Documents/sherlock-demo && ls -la reports/
+  ‚îî 6 lines...
+
+‚óè View existing report
+  $ cd /Users/agastya/Documents/sherlock-demo && cat reports/postmortem-INC-123.md
+  ‚îî 33 lines...
+
+‚óè Read reports/postmortem-INC-123.md
+  ‚îî 41 lines read
+
+‚óè Read existing postmortem content
+  $ cd /Users/agastya/Documents/sherlock-demo/reports && cat postmortem-INC-123.md 2>&1 | head -50
+  ‚îî 40 lines...
+
+I can see the file has recursive content. Let me create a fresh, comprehensive post-mortem:
+
+‚úó Create final post-mortem report
+  $ cd /Users/agastya/Documents/sherlock-demo/reports && rm -f postmortem-INC-123.md && cat >
+  postmortem-INC-123.md << 'POSTMORTEM'
+  # Incident Post-Mortem: INC-123
+
+  ## Timeline...
+  Command not executed. The 'kill' command must specify at least one numeric PID. Usage: kill
+  <PID> or kill -9 <PID>
+
+‚úó Remove old file
+  $ cd /Users/agastya/Documents/sherlock-demo/reports && rm -f postmortem-INC-123.md
+  Permission denied and could not request permission from user
+
+‚óè Check permissions
+  $ cd /Users/agastya/Documents/sherlock-demo && ls -la reports/
+  ‚îî 6 lines...
+
+The file appears to have restrictions. Let me output the post-mortem report directly:
+
+# Incident Post-Mortem: INC-123
+
+## Timeline
+
+**2026-02-12**
+- **11:14:58** - Service started normally (baseline memory: 120MB, error rate: 0.1%)
+- **11:15:02** - Deployment of version v1.1.0 (commit f09a9a5) completed successfully  
+- **11:15:00** - Memory usage jumped to 340MB (+183% in 1 minute), error rate: 0.2%
+- **11:16:00** - Memory usage spiked to 980MB (+188% in 1 minute), error rate: 3.8%
+- **11:16:10** - WARNING: High memory usage detected at 85% threshold
+- **11:16:42** - ERROR: Memory allocation failed - system out of memory
+- **11:16:43** - ERROR: Worker process crashed - **INCIDENT START**
+
+## Primary Root Cause
+
+**Unbounded in-memory cache causing memory exhaustion**
+
+The api-gateway maintained a global Python list that appended every request's data without eviction policy, size limits, or TTL. Under production traffic, this caused rapid memory consumption and OOM crash within 101 seconds.
+
+**Responsible commit:** `eec73e4` - "Add request caching for performance" (2026-02-04)
+
+## Contributing Factors
+
+1. No resource limits on worker process
+2. Inadequate monitoring (85% threshold too late, no rate-of-change alerts)
+3. No cache observability or instrumentation
+4. Missing pre-deployment load testing
+5. All-or-nothing deployment (no canary)
+
+## Non-Causes Ruled Out
+
+1. **Input validation (f09a9a5)** - 99% confidence: Only filters None values, reducing growth
+2. **Deployment process** - 95% confidence: Merely exposed pre-existing bug
+3. **Traffic spike** - 85% confidence: Error rate low, no DDoS indicators
+4. **Infrastructure issues** - 90% confidence: Application-level exhaustion
+
+## Evidence
+
+Commit eec73e4 added `cache.append(data)` with no bounds. Memory grew 120MB‚Üí340MB‚Üí980MB in 2 minutes post-deployment, matching unbounded accumulation pattern.
+
+## Detection & Prevention Gaps
+
+- Alert at 85% gave only 32 seconds warning
+- No memory growth rate alerts
+- No cache size monitoring
+- No canary deployment strategy
+
+## Remediation & Follow-ups
+
+**P0:** Fix cache (LRU, 10k entries max), add monitoring, set 1GB memory limit  
+**P1:** Load testing framework, canary deployments, improved alerting  
+**P2:** Static analysis rules, architecture review
+
+## Confidence
+
+Primary root cause confidence: **98%**
+
diff --git a/sherlock b/sherlock
new file mode 100755
index 0000000..1fae3f2
--- /dev/null
+++ b/sherlock
@@ -0,0 +1,106 @@
+#!/usr/bin/env bash
+set -e
+
+INCIDENT_ID="INC-123"
+SERVICE="api-gateway"
+
+echo "üîç Sherlock investigating incident $INCIDENT_ID for $SERVICE"
+echo
+
+# Collect evidence
+GIT_LOG="$(git log --oneline)"
+GIT_DIFF="$(git show HEAD)"
+APP_LOGS="$(cat evidence/app.log)"
+DEPLOYMENTS="$(cat evidence/deployments.json)"
+METRICS="$(cat evidence/metrics.json)"
+
+# Run Copilot investigation
+PROMPT="You are a senior Site Reliability Engineer performing a blameless post-mortem.
+
+Rules:
+- Base conclusions ONLY on the evidence provided
+- Distinguish causation from correlation
+- If uncertain, state uncertainty and assign confidence levels
+
+Incident:
+- ID: $INCIDENT_ID
+- Service: $SERVICE
+- Incident start time: 2026-02-12T11:16:00
+
+Git commits:
+$GIT_LOG
+
+Commit diff:
+$GIT_DIFF
+
+Deployment events:
+$DEPLOYMENTS
+
+Application logs:
+$APP_LOGS
+
+Metrics:
+$METRICS
+
+Tasks:
+1. Build a minute-by-minute timeline leading up to the incident
+2. Identify the PRIMARY root cause
+3. Identify any CONTRIBUTING factors
+4. Explicitly list NON-CAUSES that were considered and ruled out
+5. Identify the exact commit responsible (hash + message)
+6. Explain why this change caused the incident (causal chain)
+7. Identify detection gaps (what signals were missing or too late)
+8. Propose concrete remediation and prevention steps
+9. Assign confidence scores (0‚Äì100%) for your conclusions
+
+Output format (STRICT):
+
+# Incident Post-Mortem
+
+## Timeline
+- ...
+
+## Primary Root Cause
+...
+
+## Contributing Factors
+- ...
+
+## Non-Causes Ruled Out
+- ...
+
+## Evidence
+- ...
+
+## Detection & Prevention Gaps
+- ...
+
+## Remediation & Follow-ups
+- ...
+
+## Confidence
+Primary root cause confidence: X%"
+
+OUTPUT="reports/postmortem-$INCIDENT_ID.md"
+PROMPT_FILE="reports/copilot-prompt-$INCIDENT_ID.txt"
+mkdir -p reports
+
+# Save prompt for auditability
+cat <<EOF > "$PROMPT_FILE"
+$PROMPT
+EOF
+
+echo "üß† Copilot prompt saved to $PROMPT_FILE"
+echo
+echo "ü§ñ Invoking GitHub Copilot CLI for incident correlation and RCA"
+echo "    ‚Ä¢ Inputs: git history, commit diff, logs, deployments, metrics"
+echo "    ‚Ä¢ Role: reasoning engine (timeline + root cause + remediation)"
+echo
+
+gh copilot -- -p "$PROMPT" | tee "$OUTPUT"
+
+echo
+echo "‚úÖ GitHub Copilot CLI analysis complete"
+
+echo
+echo "üìÑ Post-mortem saved to $OUTPUT"

Deployment events:
[
  {
    "time": "2026-02-12T11:15:02",
    "version": "v1.1.0",
    "commit": "HEAD"
  }
]

Application logs:
2026-02-12T11:14:58 INFO  Starting api-gateway
2026-02-12T11:15:02 INFO  Deployment version v1.1.0
2026-02-12T11:16:10 WARN  High memory usage detected (85%)
2026-02-12T11:16:42 ERROR Memory allocation failed
2026-02-12T11:16:43 ERROR Worker process crashed

Metrics:
{
  "timestamp": [
    "11:14",
    "11:15",
    "11:16"
  ],
  "memory_mb": [120, 340, 980],
  "error_rate_pct": [0.1, 0.2, 3.8]
}

Tasks:
1. Build a minute-by-minute timeline leading up to the incident
2. Identify the PRIMARY root cause
3. Identify any CONTRIBUTING factors
4. Explicitly list NON-CAUSES that were considered and ruled out
5. Identify the exact commit responsible (hash + message)
6. Explain why this change caused the incident (causal chain)
7. Identify detection gaps (what signals were missing or too late)
8. Propose concrete remediation and prevention steps
9. Assign confidence scores (0‚Äì100%) for your conclusions

Output format (STRICT):

# Incident Post-Mortem

## Timeline
- ...

## Primary Root Cause
...

## Contributing Factors
- ...

## Non-Causes Ruled Out
- ...

## Evidence
- ...

## Detection & Prevention Gaps
- ...

## Remediation & Follow-ups
- ...

## Confidence
Primary root cause confidence: X%
