You are a senior Site Reliability Engineer performing a blameless post-mortem using hypothesis-based reasoning.

IMPORTANT: Output ONLY the markdown post-mortem document. Do not output tool invocations, permission errors, or diagnostic messages. Start immediately with the markdown header.

Rules:
- Base conclusions ONLY on the evidence provided
- Distinguish causation from correlation
- Use structured hypothesis evaluation before concluding
- If uncertain, state uncertainty and assign confidence levels

Scope Summary:
- Service: api-gateway
- Time window: 2026-02-04T00:00:00Z to 2026-02-12T23:59:00Z
- Paths: all
- Commit buffer: -10000m / +5m

Reduction Summary:
- Commits considered: 5 (excluded 0)
- Logs considered: 5 (excluded 0)
- Metrics considered: 2 (excluded 0)

Evidence Quality Notes:
- All timestamps normalized to UTC
- Missing sources: none
- Confidence penalties: none

Incident Evidence Bundle (normalized JSON):
{
  "metadata": {
    "incident_id": "INC-123",
    "service": "api-gateway",
    "environment": "demo",
    "start_time": "2026-02-04T00:00:00Z",
    "end_time": "2026-02-12T23:59:00Z",
    "timezone": "UTC"
  },
  "version_control": {
    "commits": [
      {
        "commit_hash": "6285f786522ba383ab574da4abf4b71a4befd51b",
        "author": "Agastya",
        "timestamp": "2026-02-07T07:57:58Z",
        "message": "Enhance incident analysis and governance features in Sherlock"
      },
      {
        "commit_hash": "a25c05b38cf7db56894992a88a1387d3d74dc062",
        "author": "Agastya",
        "timestamp": "2026-02-06T14:00:37Z",
        "message": "feat: Implement Phase 3 of Copilot Sherlock with structured hypothesis evaluation"
      },
      {
        "commit_hash": "7dd642087bbf86b3364a1d575cacd446e7a2869e",
        "author": "Agastya",
        "timestamp": "2026-02-05T16:16:39Z",
        "message": "Add design and limitations documentation for Copilot Sherlock"
      },
      {
        "commit_hash": "f320420cc8ad5838c16e80ed1e57ff123677d5a2",
        "author": "Agastya",
        "timestamp": "2026-02-05T16:07:28Z",
        "message": "Add initial implementation of Sherlock CLI tool for incident investigation"
      },
      {
        "commit_hash": "f09a9a5351e2a6724fa5436f6e0c2e55d8321237",
        "author": "Agastya",
        "timestamp": "2026-02-05T15:46:43Z",
        "message": "Add basic input validation to request handler"
      }
    ],
    "diffs": [
      {
        "file_path": "PHASE4-SUMMARY.md",
        "change_type": "A",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "README.md",
        "change_type": "M",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "app.py",
        "change_type": "M",
        "semantic_hint": "adds unbounded cache append"
      },
      {
        "file_path": "reports/copilot-prompt-INC-123.txt",
        "change_type": "M",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "reports/incident-bundle-INC-123.json",
        "change_type": "M",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "reports/postmortem-INC-123.md",
        "change_type": "M",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "reports/review-record-INC-123.yaml",
        "change_type": "A",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "reports/scope-audit-INC-123.json",
        "change_type": "M",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "sherlock",
        "change_type": "M",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "README.md",
        "change_type": "M",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "incident-scope.json",
        "change_type": "A",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "reports/copilot-prompt-INC-123.txt",
        "change_type": "M",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "reports/incident-bundle-INC-123.json",
        "change_type": "A",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "reports/postmortem-INC-123.md",
        "change_type": "M",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "reports/scope-audit-INC-123.json",
        "change_type": "A",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "sherlock",
        "change_type": "M",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "DESIGN.md",
        "change_type": "A",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "LIMITATIONS.md",
        "change_type": "A",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "README.md",
        "change_type": "M",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "reports/copilot-prompt-INC-123.txt",
        "change_type": "M",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "reports/postmortem-INC-123.md",
        "change_type": "M",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "sherlock",
        "change_type": "M",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "README.md",
        "change_type": "A",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "evidence/app.log",
        "change_type": "A",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "evidence/deployments.json",
        "change_type": "A",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "evidence/metrics.json",
        "change_type": "A",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "prompts/investigate.txt",
        "change_type": "A",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "reports/copilot-prompt-INC-123.txt",
        "change_type": "A",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "reports/postmortem-INC-123.md",
        "change_type": "A",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "sherlock",
        "change_type": "A",
        "semantic_hint": "n/a"
      },
      {
        "file_path": "app.py",
        "change_type": "M",
        "semantic_hint": "adds unbounded cache append"
      }
    ]
  },
  "deployments": {
    "events": [
      {
        "timestamp": "2026-02-12T11:15:02Z",
        "service": "api-gateway",
        "version": "v1.1.0",
        "commit_hash": "HEAD"
      }
    ]
  },
  "logs": {
    "entries": [
      {
        "timestamp": "2026-02-12T11:14:58Z",
        "severity": "INFO",
        "component": "api-gateway",
        "message": "Starting api-gateway"
      },
      {
        "timestamp": "2026-02-12T11:15:02Z",
        "severity": "INFO",
        "component": "api-gateway",
        "message": "Deployment version v1.1.0"
      },
      {
        "timestamp": "2026-02-12T11:16:10Z",
        "severity": "WARN",
        "component": "api-gateway",
        "message": "High memory usage detected (85%)"
      },
      {
        "timestamp": "2026-02-12T11:16:42Z",
        "severity": "ERROR",
        "component": "api-gateway",
        "message": "allocation failed"
      },
      {
        "timestamp": "2026-02-12T11:16:43Z",
        "severity": "ERROR",
        "component": "api-gateway",
        "message": "process crashed"
      }
    ]
  },
  "metrics": {
    "aggregates": {
      "memory_mb": {
        "baseline": 120,
        "pre_incident": 340,
        "peak": 980,
        "delta": 860,
        "unit": "mb",
        "direction": "up"
      },
      "error_rate_pct": {
        "baseline": 0.1,
        "pre_incident": 0.2,
        "peak": 3.8,
        "delta": 3.6999999999999997,
        "unit": "pct",
        "direction": "up"
      }
    }
  },
  "integrity": {
    "missing_sources": [],
    "confidence_penalties": []
  }
}

PHASE 3: HYPOTHESIS-BASED REASONING PROTOCOL

You MUST perform hypothesis-based reasoning. Follow this exact sequence:

Instructions:
1. Enumerate 3-5 plausible hypotheses for the incident
2. Hypotheses MUST span different categories:
   - Application logic (code bugs, unbounded growth, etc.)
   - Infrastructure (hardware, networking, resource limits)
   - Traffic/Load (volume spikes, DDoS, unusual patterns)
   - Configuration (settings, deployment config, environment vars)
   - Dependencies/Runtime (libraries, platform, external services)
3. For EACH hypothesis:
   - List evidence FOR the hypothesis
   - List evidence AGAINST the hypothesis
   - Assign a confidence score (0-100%)
4. Total confidence across ALL hypotheses must not exceed 100%
5. Explicitly RULE OUT hypotheses that are not supported
6. Only AFTER elimination, select a primary root cause
7. State remaining uncertainty clearly

Required Output Structure (STRICT - do not skip or reorder):

# Incident Post-Mortem: INC-123

## Timeline
[Minute-by-minute sequence of events]

## Hypotheses Considered

### Hypothesis 1: [Name] (Category: [Application/Infra/Traffic/Config/Dependency])
**Evidence FOR:**
- [Evidence item 1]
- [Evidence item 2]

**Evidence AGAINST:**
- [Counter-evidence item 1]
- [Counter-evidence item 2]

**Confidence:** [X]%
**Status:** [CONFIRMED/RULED_OUT/POSSIBLE]

[Repeat for all hypotheses]

## Evidence Evaluation
[Cross-hypothesis evidence analysis]

## Ruled-Out Hypotheses
[Explicitly list hypotheses that were eliminated and WHY]

## Primary Root Cause
[Selected hypothesis with justification based on elimination]
**Commit:** [hash] - [message]
**Causal Chain:** [Step-by-step explanation]

## Contributing Factors
[Amplifiers of the root cause, NOT alternative explanations]

## Detection & Prevention Gaps
[What signals were missing or too late]

## Remediation & Follow-ups
[Concrete actions]

## Remaining Uncertainty
[What you don't know and why]

## Confidence Summary
- Primary root cause confidence: [X]%
- Total hypothesis confidence budget used: [Y]%
- Uncertainty factors: [list]

CRITICAL REQUIREMENTS:
- At least 3 hypotheses with different categories
- Each hypothesis must have BOTH evidence for AND against
- At least one hypothesis must be explicitly RULED_OUT
- Confidence scores must sum to â‰¤100%
- Contributing factors must NOT be listed as separate hypotheses
- Root cause selection must reference hypothesis elimination
